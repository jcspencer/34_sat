/*!
 * 3/4 Informatics SAT (James Spencer) v0.0.1
 * Copyright 2016 James Spencer
 * License: All Rights Reserved
 */
!function(){function t(t,e){var r=function(t,e){return t+e},a=function(t){return t.reduce(r)/t.length},n=a(t),o=a(e),d=t.map(function(t){return Math.pow(t-n,2)}).reduce(r),i=e.map(function(t){return Math.pow(t-o,2)}).reduce(r),s=t.map(function(t,r){return(t-n)*(e[r]-o)}).reduce(r),c=d3.round(s/d,4),l=d3.round(o-n*c,4),u=d3.round(Math.pow(s,2)/(d*i),4);return[c,l,u]}var e=d3.select("#scatterplot"),r={top:20,right:20,bottom:30,left:40},a=parseInt(e.style("width"),10)-r.left-r.right,n=500-r.top-r.bottom,o=d3.format("$0.2f"),d=d3.format("0.4f"),i=ƒ("fees"),s=d3.scale.linear().range([0,a]),c=function(t){return s(i(t))},l=d3.svg.axis().scale(s).orient("bottom").tickFormat(function(t){return t/1e3+"k"}),u=ƒ("median"),f=d3.scale.linear().range([n,0]),p=function(t){return f(u(t))},m=d3.svg.axis().scale(f).orient("left"),x=e.append("svg").attr("width",a+r.left+r.right).attr("height",n+r.top+r.bottom).append("g").attr("transform","translate("+r.left+","+r.top+")"),h=d3.scale.category10(),g=d3.tip().attr("class","d3-tip").direction("e").html(function(t){var e=t.median,r=o(t.fees),a=t.name;return"<i>"+a+"</i> ("+r+", "+e+")"});x.call(g),d3.csv("/dist/data/state/fees.csv",function(e,r){r.forEach(function(t){t.fees=+t.fees,t.median=+t.median}),s.domain([d3.min(r,i)-1,d3.max(r,i)+1]),f.domain([d3.min(r,u)-.5,d3.max(r,u)+1]),x.append("g").attr("class","x axis").attr("transform","translate(0,"+n+")").call(l).append("text").attr("class","label").attr("x",a).attr("y",-6).style("text-anchor","end").text("Fees ($ AUD)"),x.append("g").attr("class","y axis").call(m).append("text").attr("class","label").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("Median Score"),x.selectAll(".dot").data(r).enter().append("circle").attr("class","dot").attr("r",5).attr("cx",c).attr("cy",p).attr("fill",function(t,e){return h(e)}).on("mouseover",g.show).on("mousedown",g.show);var o=r.map(ƒ("fees")),y=r.map(ƒ("median")),v=t(o,y),w=d3.min(r,i),b=v[0]*w+v[1],A=d3.max(r,i),k=v[0]*A+v[1],M=[[w,b,A,k]],q=x.selectAll(".trendline").data(M);q.enter().append("line").attr("class","trendline").attr("x1",function(t){return s(t[0])}).attr("y1",function(t){return f(t[1])}).attr("x2",function(t){return s(t[2])}).attr("y2",function(t){return f(t[3])}).attr("stroke","#5E9BAA").attr("stroke-width",2),x.append("text").text("eq: "+d(v[0])+"x + "+d(v[1])).attr("class","text-label").attr("x",function(t){return s(A)-200}).attr("y",function(t){return f(b)+80+30}),x.append("text").text("r-sq: "+d(v[2])).attr("class","text-label").attr("x",function(t){return s(A)-200}).attr("y",function(t){return f(b)+80+10})})}();