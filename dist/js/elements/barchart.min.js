/*!
 * 3/4 Informatics SAT (James Spencer) v0.0.1
 * Copyright 2016 James Spencer
 * License: All Rights Reserved
 */
! function() {
    function t(t) {
        function a(t) {
            return t.pct = +t.pct, t.median = +t.median, t.students = +t.students, t
        }
        var n = t.margin,
            r = t.width,
            e = t.height,
            i = t.element,
            o = t.data,
            s = 0,
            c = t.domain_sway_min || 4,
            d = t.domain_sway_max || 4,
            m = i.append("svg").attr("width", r + n.left + n.right).attr("height", e + n.top + n.bottom).attr("preserveAspectRatio", "xMidYMid meet").append("g").attr("transform", "translate(" + n.left + "," + n.top + ")"),
            l = d3.scale.linear().range([s, r]),
            h = d3.scale.ordinal().rangeRoundBands([s, e], .1),
            u = d3.svg.axis().scale(l).orient("bottom").tickFormat(function(t) {
                return t.toFixed(0)
            }),
            p = d3.svg.axis().scale(h).orient("left").tickSize(0).tickPadding(6),
            f = d3.tip().attr("class", "d3-tip").offset([-10, 0]).html(function(t) {
                var a = t.pct,
                    n = t.median;
                return "<span class='figure'>" + ((a <= 0 ? "" : "+") + a) + "% <i>(" + n + ")</i></span>"
            });
        m.call(f), d3.csv(o, a, function(t, a) {
            var n = d3.min(a, ƒ("pct")) - c,
                r = d3.max(a, ƒ("pct")) + d;
            l.domain([n, r]).nice(), h.domain(a.map(ƒ("name"))), m.selectAll(".bar").data(a).enter().append("rect").attr("class", function(t) {
                return "bar bar--" + t["class"]
            }).attr("x", function(t) {
                return l(Math.min(s, t.pct))
            }).attr("y", function(t) {
                return h(t.name)
            }).attr("width", function(t) {
                return Math.abs(l(t.pct) - l(s))
            }).attr("height", h.rangeBand()).on("mouseover", f.show).on("mousedown", f.show).on("touchstart", f.show).on("mouseout", f.hide).on("mouseup", f.hide);
            m.append("g").attr("class", "x axis").attr("transform", "translate(0," + e + ")").call(u), m.append("g").attr("class", "y axis").attr("transform", "translate(" + l(s) + ",0)").call(p)
        })
    }

    function a(a, n, r) {
        var a = d3.select(a),
            e = {
                top: 20,
                right: 30,
                bottom: 40,
                left: 30
            },
            i = parseInt(a.style("width"), 10) - e.left - e.right,
            o = 200 - e.top - e.bottom,
            s = "/34_sat/dist/data/results/" + n + ".csv";
        t({
            margin: e,
            height: o,
            width: i,
            element: a,
            data: s,
            domain_sway_min: r[0],
            domain_sway_max: r[1]
        })
    }
    window.datums = [];
    var n = [
        ["#bsw_barchart", "barwon_south_west", [0, 0]],
        ["#em_barchart", "eastern_metropolitan", [5, 2]],
        ["#wm_barchart", "western_metropolitan", [.5, 1]],
        ["#nm_barchart", "northern_metropolitan", [0, 0]],
        ["#sm_barchart", "southern_metropolitan", [2, 1]],
        ["#gi_barchart", "gippsland", [0, 0]],
        ["#gr_barchart", "grampians", [0, 0]],
        ["#hu_barchart", "hume", [0, 0]],
        ["#lm_barchart", "loddon_mallee", [0, 0]],
        ["#statewide_barchart", "state", [0, 0]]
    ];
    $(document).ready(function() {
        n.forEach(function(t) {
            a(t[0], t[1], t[2])
        })
    })
}();